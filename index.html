<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#0f0f1a" />
  <title>ğŸµ ìŒì•… ì»¤ë¦¬í˜ëŸ¼ ë§¤ë‹ˆì €</title>
  <meta name="description" content="ì´ˆë“± ì €í•™ë…„ ì˜¤ì¹´ë¦¬ë‚˜ & ìš°ì¿¨ë ë ˆ 20ì£¼ ì»¤ë¦¬í˜ëŸ¼ ìŠ¤ì¼€ì¤„ ê´€ë¦¬ ì•±" />
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icon-192.svg" type="image/svg+xml" />
  <link rel="apple-touch-icon" href="icon-192.svg" />
  <link rel="stylesheet" href="index.css" />
</head>

<body>
  <div class="app" id="app">
    <!-- Header -->
    <header class="header">
      <div>
        <h1 class="header__title">ğŸµ ìŒì•… ì»¤ë¦¬í˜ëŸ¼</h1>
        <p class="header__subtitle">ì´ˆë“± ì €í•™ë…„ Â· 20ì£¼ ê³¼ì •</p>
      </div>
      <div class="header__actions">
        <button class="header__btn" id="btn-reset" title="ë°ì´í„° ì´ˆê¸°í™”">ğŸ”„</button>
      </div>
    </header>

    <!-- Bottom Navigation (serves as main tabs) -->
    <nav class="tabs" id="main-tabs">
      <button class="tab active" data-tab="calendar">ğŸ“… ìº˜ë¦°ë”</button>
      <button class="tab" data-tab="ocarina">ğŸµ ì˜¤ì¹´ë¦¬ë‚˜</button>
      <button class="tab" data-tab="ukulele">ğŸ¸ ìš°ì¿¨ë ë ˆ</button>
    </nav>

    <!-- Main Content -->
    <main class="content">
      <!-- Calendar View -->
      <section class="view active" id="view-calendar">
        <div class="stats" id="stats"></div>
        <div class="calendar" id="calendar"></div>
        <div class="day-events" id="day-events"></div>
      </section>

      <!-- Ocarina List View -->
      <section class="view" id="view-ocarina">
        <div id="ocarina-list"></div>
      </section>

      <!-- Ukulele List View -->
      <section class="view" id="view-ukulele">
        <div id="ukulele-list"></div>
      </section>
    </main>

    <!-- FAB -->
    <button class="fab" id="fab" title="ìˆ˜ì—… ì¶”ê°€">ï¼‹</button>
  </div>

  <!-- Add/Edit Modal -->
  <div class="modal-overlay" id="modal-overlay">
    <div class="modal" id="modal">
      <div class="modal__handle"></div>
      <h2 class="modal__title" id="modal-title">ìˆ˜ì—… ì¶”ê°€</h2>
      <form id="lesson-form">
        <input type="hidden" id="form-id" />
        <div class="form-row">
          <div class="form-group">
            <label for="form-instrument">ì•…ê¸°</label>
            <select id="form-instrument">
              <option value="ocarina">ğŸµ ì˜¤ì¹´ë¦¬ë‚˜</option>
              <option value="ukulele">ğŸ¸ ìš°ì¿¨ë ë ˆ</option>
            </select>
          </div>
          <div class="form-group">
            <label for="form-week">ì£¼ì°¨</label>
            <input type="number" id="form-week" min="1" max="99" placeholder="1" />
          </div>
        </div>
        <div class="form-group">
          <label for="form-title">ìˆ˜ì—… ì£¼ì œ</label>
          <input type="text" id="form-title" placeholder="ì˜ˆ: ì˜¤ì¹´ë¦¬ë‚˜ì™€ ì¹œí•´ì§€ê¸°" />
        </div>
        <div class="form-group">
          <label for="form-desc">ì„¸ë¶€ ë‚´ìš©</label>
          <textarea id="form-desc" rows="3" placeholder="ìˆ˜ì—… ì„¸ë¶€ ë‚´ìš©ì„ ì ì–´ì£¼ì„¸ìš”"></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="form-song">í•™ìŠµ ê³¡(ì„ íƒ)</label>
            <input type="text" id="form-song" placeholder="ì˜ˆ: ë¹„í–‰ê¸°" />
          </div>
          <div class="form-group">
            <label for="form-date">ìˆ˜ì—… ë‚ ì§œ(ì„ íƒ)</label>
            <input type="date" id="form-date" />
          </div>
        </div>
        <div class="form-group">
          <label for="form-status">ì§„í–‰ ìƒíƒœ</label>
          <select id="form-status">
            <option value="upcoming">ì˜ˆì •</option>
            <option value="done">ì™„ë£Œ</option>
          </select>
        </div>
        <div class="modal__btns">
          <button type="button" class="btn btn--cancel" id="btn-cancel">ì·¨ì†Œ</button>
          <button type="submit" class="btn btn--save">ì €ì¥</button>
        </div>
        <div class="modal__btns" id="delete-row" style="display:none;">
          <button type="button" class="btn btn--delete" id="btn-delete">ğŸ—‘ï¸ ì´ ìˆ˜ì—… ì‚­ì œ</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Confirm Dialog -->
  <div class="confirm-overlay" id="confirm-overlay">
    <div class="confirm-dialog">
      <div class="confirm-dialog__title" id="confirm-title">í™•ì¸</div>
      <div class="confirm-dialog__msg" id="confirm-msg">ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
      <div class="confirm-dialog__btns">
        <button class="btn btn--cancel" id="confirm-no">ì•„ë‹ˆì˜¤</button>
        <button class="btn btn--delete" id="confirm-yes">ì‚­ì œ</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <script>
    /* ===========================================
       Music Curriculum Manager â€“ App Logic
       =========================================== */
    (() => {
      'use strict';

      // â”€â”€â”€ Default Curriculum Data â”€â”€â”€
      const DEFAULT_OCARINA = [
        { week: 1, title: "ì˜¤ì¹´ë¦¬ë‚˜ì™€ ì¹œí•´ì§€ê¸°", desc: "ì•…ê¸° ì†Œê°œ, êµ¬ì¡° ì•Œê¸°, ë°”ë¥¸ ìì„¸ì™€ ì•…ê¸° ì¥ëŠ” ë²•", song: "(íƒìƒ‰ ë° ì†Œë¦¬ ë‚´ë³´ê¸°)" },
        { week: 2, title: "ì˜ˆìœ ì†Œë¦¬ ë§Œë“¤ê¸°", desc: "í……ì‰(Tu) ê¸°ì´ˆ, í˜¸í¡ë²•, 'ì†”, ë¼, ì‹œ' ìš´ì§€ ìµíˆê¸°", song: "ë¹„í–‰ê¸° (ì•ë¶€ë¶„)" },
        { week: 3, title: "ê¸°ì´ˆ ìŒê³„ ë‹¤ì§€ê¸° 1", desc: "'ë„, ë ˆ, ë¯¸, íŒŒ' ìš´ì§€ ìµíˆê¸°, ë¡±í†¤ ì—°ìŠµ", song: "ë¹„í–‰ê¸° (ì™„ê³¡)" },
        { week: 4, title: "ê¸°ì´ˆ ìŒê³„ ë‹¤ì§€ê¸° 2", desc: "ë†’ì€ 'ë„, ë ˆ' ìš´ì§€ë²•, ë‚®ì€ìŒê³¼ ë†’ì€ìŒ ì˜¤ê°€ê¸°", song: "í•™êµ ì¢…" },
        { week: 5, title: "ë¦¬ë“¬ê³¼ ë°•ì ë†€ì´", desc: "4ë¶„ìŒí‘œ, 2ë¶„ìŒí‘œ ìµíˆê¸°, ë°•ìì— ë§ì¶° í……ì‰í•˜ê¸°", song: "ë‚˜ë¹„ì•¼" },
        { week: 6, title: "ì™ˆì¸  ë¦¬ë“¬ ë°°ìš°ê¸°", desc: "3/4ë°•ì ë¦¬ë“¬ê° ìµíˆê¸°, ë¶€ë“œëŸ¬ìš´ í˜¸í¡ ì—°ìŠµ", song: "ë»ê¾¸ê¸°" },
        { week: 7, title: "ì‰¼í‘œì˜ ë¯¸í•™", desc: "ì‰¼í‘œ ì§€í‚¤ê¸°, í˜¸í¡ ì¡°ì ˆí•˜ë©° ëŠì–´ ë¶ˆê¸°", song: "ì‚°í† ë¼" },
        { week: 8, title: "ë‚®ì€ ìŒ ì •ë³µí•˜ê¸°", desc: "ë‚®ì€ 'ì‹œ, ë¼' ìš´ì§€ë²•, í˜¸í¡ì„ ì•ˆì •ì ìœ¼ë¡œ ë‚´ë¦¬ê¸°", song: "ì‘ì€ ë³„" },
        { week: 9, title: "ì¤‘ê°„ ì ê²€ ë° ë³µìŠµ", desc: "ì§€ê¸ˆê¹Œì§€ ë°°ìš´ ìš´ì§€ë²• ì´ì •ë¦¬, ì¢‹ì•„í•˜ëŠ” ê³¡ ì—°ì£¼", song: "(ë°°ìš´ ê³¡ ì¤‘ ì„ íƒ)" },
        { week: 10, title: "ìŠ¤íƒ€ì¹´í†  ìµíˆê¸°", desc: "ì§§ê³  ê²½ì¾Œí•˜ê²Œ í……ì‰í•˜ê¸° (Tut), ë¦¬ë“¬ê° ì‚´ë¦¬ê¸°", song: "ê±°ë¯¸" },
        { week: 11, title: "ì´ìŒì¤„(Slur) ì—°ì£¼", desc: "ë¶€ë“œëŸ½ê²Œ ì´ì–´ì„œ ë¶ˆê¸°, í……ì‰ ì—†ì´ ìŒ ì—°ê²°í•˜ê¸°", song: "ì•„ë¹  í˜ë‚´ì„¸ìš”" },
        { week: 12, title: "ì ìŒí‘œ ë¦¬ë“¬ ë°°ìš°ê¸°", desc: "ì 4ë¶„ìŒí‘œ ë¦¬ë“¬ê°(ë”´~ë”°) ìµíˆê¸°", song: "ê³° ì„¸ ë§ˆë¦¬" },
        { week: 13, title: "ë†’ì€ ìŒ ë„ì „í•˜ê¸°", desc: "ë†’ì€ 'ë¯¸, íŒŒ' ìš´ì§€ë²• (í•„ìš” ì‹œ), ê³ ìŒì—­ëŒ€ í˜¸í¡", song: "ì–¼êµ´ ì°Œí‘¸ë¦¬ì§€ ë§ì•„ìš”" },
        { week: 14, title: "ì…ˆì—¬ë¦¼ í‘œí˜„í•˜ê¸°", desc: "í¬ë ˆì„¼ë„(ì ì  ì„¸ê²Œ), ë°í¬ë ˆì„¼ë„(ì ì  ì—¬ë¦¬ê²Œ) ë§›ë³´ê¸°", song: "ê³ í–¥ì˜ ë´„" },
        { week: 15, title: "2ì¤‘ì£¼ ë§›ë³´ê¸°", desc: "ë‘ ê·¸ë£¹ìœ¼ë¡œ ë‚˜ëˆ„ì–´ í™”ìŒì˜ ì¬ë¯¸ ëŠë¼ê¸°", song: "(ì‰¬ìš´ ë™ìš” 2ì„±ë¶€)" },
        { week: 16, title: "ë‚˜ì˜ 18ë²ˆ ë§Œë“¤ê¸° 1", desc: "ë°œí‘œíšŒ ê³¡ ì„ ì • ë° ì•…ë³´ ë¦¬ë”©", song: "(ììœ ê³¡ ì„ ì •)" },
        { week: 17, title: "ë‚˜ì˜ 18ë²ˆ ë§Œë“¤ê¸° 2", desc: "êµ¬ê°„ ë°˜ë³µ ì—°ìŠµ, ì•ˆ ë˜ëŠ” ë¶€ë¶„ ì§‘ì¤‘ ë ˆìŠ¨", song: "(ììœ ê³¡ ì„ ì •)" },
        { week: 18, title: "ì•™ìƒë¸” ì—°ìŠµ", desc: "ì¹œêµ¬ë“¤ê³¼ í˜¸í¡ ë§ì¶”ê¸°, ë°•ì ë§ì¶”ê¸°", song: "(í•©ì£¼ê³¡)" },
        { week: 19, title: "ë¦¬í—ˆì„¤", desc: "ë°œí‘œíšŒ ì˜ˆí–‰ ì—°ìŠµ, ë¬´ëŒ€ ë§¤ë„ˆ(ì¸ì‚¬ë²•) ë°°ìš°ê¸°", song: "ì „ì²´ ê³¡" },
        { week: 20, title: "ì‘ì€ ìŒì•…íšŒ", desc: "ê·¸ë™ì•ˆ ë°°ìš´ ê³¡ ë°œí‘œ ë° ìˆ˜ë£Œ íŒŒí‹°", song: "-" },
      ];

      const DEFAULT_UKULELE = [
        { week: 1, title: "ìš°ì¿¨ë ë ˆì™€ ì•ˆë…•?", desc: "ì•…ê¸° ëª…ì¹­, ì•ˆëŠ” ìì„¸, ì¤„(í˜„) ë²ˆí˜¸ ì•Œê¸°, ê°œë°©í˜„ íŠ•ê¸°ê¸°", song: "(ì¤„ íŠ•ê²¨ë³´ê¸° ë†€ì´)" },
        { week: 2, title: "ì²« ë²ˆì§¸ ì½”ë“œ 'C'", desc: "ì™¼ì† ì†ê°€ë½ ë²ˆí˜¸, Cì½”ë“œ ì¡ê¸°, ì—„ì§€ ìŠ¤íŠ¸ë¡œí¬(ë‹¤ìš´)", song: "ê³° ì„¸ ë§ˆë¦¬" },
        { week: 3, title: "ì¹œêµ¬ ì½”ë“œ 'F'", desc: "Fì½”ë“œ ìš´ì§€ë²•, C-F ì½”ë“œ ì—°ê²° ì—°ìŠµ", song: "ê±°ë¯¸" },
        { week: 4, title: "ì•„ê¸° ì½”ë“œ 'C7'", desc: "C7ì½”ë“œ ìš´ì§€ë²•, ì½”ë“œ ì²´ì¸ì§€ ì—°ìŠµ (C-C7-F)", song: "ì†œì‚¬íƒ•" },
        { week: 5, title: "4ë¹„íŠ¸ ë¦¬ë“¬ ì¹˜ê¸°", desc: "ê²€ì§€ ìŠ¤íŠ¸ë¡œí¬(ë‹¤ìš´-ì—…), 4ë¹„íŠ¸ ê³ ê³  ë¦¬ë“¬", song: "ë‚˜ë¹„ì•¼" },
        { week: 6, title: "êµ­ë¯¼ ì½”ë“œ 'G7'", desc: "G7ì½”ë“œ ìš´ì§€ë²•(ì¡°ê¸ˆ ì–´ë ¤ì›€, ë°˜ë³µ ì—°ìŠµ), C-F-G7 ì§„í–‰", song: "ì˜¬ì±™ì´ì™€ ê°œêµ¬ë¦¬" },
        { week: 7, title: "8ë¹„íŠ¸ ë¦¬ë“¬ ë§›ë³´ê¸°", desc: "ë‹¤ìš´-ì—… ìŠ¤íŠ¸ë¡œí¬ ì—°ê²°, 8ë¹„íŠ¸ ê³ ê³  ë¦¬ë“¬ ê¸°ì´ˆ", song: "ë™ë¬¼ë†ì¥" },
        { week: 8, title: "ì™ˆì¸  ë¦¬ë“¬ ë°°ìš°ê¸°", desc: "3/4ë°•ì 'ì¿µ-ì§-ì§' ë¦¬ë“¬ ì¹˜ê¸°", song: "ìƒì¼ ì¶•í•˜í•©ë‹ˆë‹¤" },
        { week: 9, title: "ì¹¼ë¦½ì†Œ ë¦¬ë“¬ 1", desc: "ë‹¤ìš´-ë‹¤ìš´ì—…-ì—…-ë‹¤ìš´ì—… (ê°€ì¥ ì¤‘ìš”í•œ ë¦¬ë“¬) ì…ìœ¼ë¡œ ìµíˆê¸°", song: "(ë¦¬ë“¬ ì§‘ì¤‘ ì—°ìŠµ)" },
        { week: 10, title: "ì¹¼ë¦½ì†Œ ë¦¬ë“¬ 2", desc: "ì¹¼ë¦½ì†Œ ë¦¬ë“¬ì„ ê³¡ì— ì ìš©í•˜ê¸°", song: "ì¡°ê°œ ê»ì§ˆ ë¬¶ì–´" },
        { week: 11, title: "'Am' ì½”ë“œì™€ ë§ˆì´ë„ˆ", desc: "Am, Dm ì½”ë“œ ìµíˆê¸°, ìŠ¬í”ˆ ëŠë‚Œì˜ ê³¡ ì³ë³´ê¸°", song: "ì¹ ê°‘ì‚°(ë©œë¡œë””ë§Œ)" },
        { week: 12, title: "ì…”í”Œ ë¦¬ë“¬", desc: "ê¹¡ì¶©ê¹¡ì¶© ë›°ëŠ” ë¦¬ë“¬(ìŠ¤ìœ™) ëŠë‚Œ ì‚´ë¦¬ê¸°", song: "ìˆ² ì†ì˜ ìŒì•…ê°€" },
        { week: 13, title: "íƒ€ë¸Œ(TAB) ì•…ë³´ ë³´ê¸°", desc: "ë©œë¡œë”” ì—°ì£¼ ê¸°ì´ˆ, ê³„ì´ë¦„ 'ë„ë ˆë¯¸íŒŒì†”ë¼ì‹œë„' ì°¾ê¸°", song: "í•™êµ ì¢… (ë©œë¡œë””)" },
        { week: 14, title: "ë©œë¡œë””ì™€ ë°˜ì£¼", desc: "ì„ ìƒë‹˜ ë°˜ì£¼ì— ë§ì¶° ë©œë¡œë”” ì³ë³´ê¸°", song: "ì‘ì€ ë³„" },
        { week: 15, title: "ì»·íŒ… ì£¼ë²• 1", desc: "ì˜¤ë¥¸ì† ì»·íŒ…(ì°©!), ë¦¬ë“¬ì— ì•…ì„¼íŠ¸ ë„£ê¸°", song: "ë©‹ìŸì´ í† ë§ˆí† " },
        { week: 16, title: "ë‚˜ì˜ ì• ì°½ê³¡ ì—°ìŠµ 1", desc: "ë°œí‘œíšŒ ê³¡ ì„ ì •, ì½”ë“œ ì§„í–‰ ë°˜ë³µ ìˆ™ë‹¬", song: "(ììœ ê³¡ ì„ ì •)" },
        { week: 17, title: "ë‚˜ì˜ ì• ì°½ê³¡ ì—°ìŠµ 2", desc: "ë…¸ë˜ ë¶€ë¥´ë©° ì—°ì£¼í•˜ê¸°(íƒ„í˜„ê³¼ ê°€ì°½ì˜ ì¡°í™”)", song: "(ììœ ê³¡ ì„ ì •)" },
        { week: 18, title: "í•©ì£¼ ì—°ìŠµ", desc: "ê·¸ë£¹ë³„ ì—°ìŠµ (ë©œë¡œë”” íŒŒíŠ¸ / ë°˜ì£¼ íŒŒíŠ¸)", song: "(í•©ì£¼ê³¡)" },
        { week: 19, title: "ë¦¬í—ˆì„¤", desc: "ëª¨ì˜ ë°œí‘œíšŒ, ì„œë¡œ ë“¤ì–´ì£¼ê³  ë°•ìˆ˜ì¹˜ê¸°", song: "ì „ì²´ ê³¡" },
        { week: 20, title: "ì‘ì€ ìŒì•…íšŒ", desc: "ì—°ì£¼ ë°œí‘œ ë° ìˆ˜ë£Œì‹", song: "-" },
      ];

      // â”€â”€â”€ Storage â”€â”€â”€
      const STORAGE_KEY = 'music_curriculum_data';

      function loadData() {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) return JSON.parse(raw);
        return initDefaultData();
      }

      function saveData(data) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      }

      function initDefaultData() {
        let id = 1;
        const lessons = [];
        // Start date: next Monday from today
        const today = new Date();
        const dayOfWeek = today.getDay();
        const nextMonday = new Date(today);
        nextMonday.setDate(today.getDate() + (dayOfWeek === 0 ? 1 : dayOfWeek === 1 ? 0 : 8 - dayOfWeek));

        DEFAULT_OCARINA.forEach((l, i) => {
          const d = new Date(nextMonday);
          d.setDate(d.getDate() + i * 7);
          lessons.push({
            id: id++,
            instrument: 'ocarina',
            week: l.week,
            title: l.title,
            desc: l.desc,
            song: l.song,
            date: formatDate(d),
            status: 'upcoming',
          });
        });

        DEFAULT_UKULELE.forEach((l, i) => {
          const d = new Date(nextMonday);
          d.setDate(d.getDate() + i * 7);
          lessons.push({
            id: id++,
            instrument: 'ukulele',
            week: l.week,
            title: l.title,
            desc: l.desc,
            song: l.song,
            date: formatDate(d),
            status: 'upcoming',
          });
        });

        const data = { lessons, nextId: id };
        saveData(data);
        return data;
      }

      // â”€â”€â”€ Helpers â”€â”€â”€
      function formatDate(d) {
        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, '0');
        const dd = String(d.getDate()).padStart(2, '0');
        return `${y}-${m}-${dd}`;
      }

      function toDateObj(str) {
        if (!str) return null;
        const [y, m, d] = str.split('-').map(Number);
        return new Date(y, m - 1, d);
      }

      function koreanDate(str) {
        if (!str) return '';
        const d = toDateObj(str);
        const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
        return `${d.getMonth() + 1}ì›” ${d.getDate()}ì¼ (${days[d.getDay()]})`;
      }

      // â”€â”€â”€ State â”€â”€â”€
      let data = loadData();
      let currentTab = 'calendar';
      let calYear, calMonth; // 0-indexed month
      let selectedDate = null;
      let editingId = null;

      const todayObj = new Date();
      calYear = todayObj.getFullYear();
      calMonth = todayObj.getMonth();

      // â”€â”€â”€ DOM References â”€â”€â”€
      const $tabs = document.querySelectorAll('#main-tabs .tab');
      const $views = document.querySelectorAll('.view');
      const $calendar = document.getElementById('calendar');
      const $dayEvents = document.getElementById('day-events');
      const $stats = document.getElementById('stats');
      const $ocarList = document.getElementById('ocarina-list');
      const $ukuList = document.getElementById('ukulele-list');
      const $fab = document.getElementById('fab');
      const $modalOvl = document.getElementById('modal-overlay');
      const $modal = document.getElementById('modal');
      const $modalTitle = document.getElementById('modal-title');
      const $form = document.getElementById('lesson-form');
      const $deleteRow = document.getElementById('delete-row');
      const $confirmOvl = document.getElementById('confirm-overlay');
      const $toast = document.getElementById('toast');

      // Form fields
      const $fId = document.getElementById('form-id');
      const $fInstrument = document.getElementById('form-instrument');
      const $fWeek = document.getElementById('form-week');
      const $fTitle = document.getElementById('form-title');
      const $fDesc = document.getElementById('form-desc');
      const $fSong = document.getElementById('form-song');
      const $fDate = document.getElementById('form-date');
      const $fStatus = document.getElementById('form-status');

      // â”€â”€â”€ Tab Switching â”€â”€â”€
      $tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          currentTab = tab.dataset.tab;
          $tabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          $views.forEach(v => v.classList.remove('active'));
          document.getElementById(`view-${currentTab}`).classList.add('active');
          render();
        });
      });

      // â”€â”€â”€ Calendar Rendering â”€â”€â”€
      function renderCalendar() {
        const firstDay = new Date(calYear, calMonth, 1).getDay(); // 0=Sun
        const daysInMonth = new Date(calYear, calMonth + 1, 0).getDate();
        const monthNames = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”',
          '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
        const dayLabels = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];

        // Build lesson lookup for this month
        const lessonsByDay = {};
        data.lessons.forEach(l => {
          if (!l.date) return;
          const d = toDateObj(l.date);
          if (d.getFullYear() === calYear && d.getMonth() === calMonth) {
            const day = d.getDate();
            if (!lessonsByDay[day]) lessonsByDay[day] = [];
            lessonsByDay[day].push(l);
          }
        });

        const todayStr = formatDate(todayObj);

        let html = `
        <div class="calendar__nav">
          <button class="calendar__arrow" id="cal-prev">â—€</button>
          <span class="calendar__month">${calYear}ë…„ ${monthNames[calMonth]}</span>
          <button class="calendar__arrow" id="cal-next">â–¶</button>
        </div>
        <div class="calendar__grid">
      `;

        dayLabels.forEach(d => {
          html += `<div class="calendar__day-label">${d}</div>`;
        });

        for (let i = 0; i < firstDay; i++) {
          html += `<div class="calendar__day empty"></div>`;
        }

        for (let d = 1; d <= daysInMonth; d++) {
          const dateStr = `${calYear}-${String(calMonth + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
          const isToday = dateStr === todayStr;
          const isSelected = dateStr === selectedDate;
          const lessons = lessonsByDay[d] || [];
          const hasOcarina = lessons.some(l => l.instrument === 'ocarina');
          const hasUkulele = lessons.some(l => l.instrument === 'ukulele');

          let cls = 'calendar__day';
          if (isToday) cls += ' today';
          if (isSelected) cls += ' selected';

          let dots = '';
          if (hasOcarina || hasUkulele) {
            dots = '<div class="calendar__dots">';
            if (hasOcarina) dots += '<span class="calendar__dot calendar__dot--ocarina"></span>';
            if (hasUkulele) dots += '<span class="calendar__dot calendar__dot--ukulele"></span>';
            dots += '</div>';
          }

          html += `<div class="${cls}" data-date="${dateStr}">${d}${dots}</div>`;
        }

        html += '</div>';
        $calendar.innerHTML = html;

        // Nav events
        document.getElementById('cal-prev').addEventListener('click', () => {
          calMonth--;
          if (calMonth < 0) { calMonth = 11; calYear--; }
          selectedDate = null;
          renderCalendar();
          renderDayEvents();
        });
        document.getElementById('cal-next').addEventListener('click', () => {
          calMonth++;
          if (calMonth > 11) { calMonth = 0; calYear++; }
          selectedDate = null;
          renderCalendar();
          renderDayEvents();
        });

        // Day click
        $calendar.querySelectorAll('.calendar__day:not(.empty)').forEach(el => {
          el.addEventListener('click', () => {
            selectedDate = el.dataset.date;
            renderCalendar();
            renderDayEvents();
          });
        });
      }

      function renderDayEvents() {
        if (!selectedDate) {
          $dayEvents.innerHTML = '';
          return;
        }

        const lessons = data.lessons.filter(l => l.date === selectedDate);
        let html = `<div class="day-events__title">ğŸ“Œ ${koreanDate(selectedDate)}</div>`;

        if (lessons.length === 0) {
          html += `<div class="day-events__empty">ì´ ë‚ ì— ì˜ˆì •ëœ ìˆ˜ì—…ì´ ì—†ìŠµë‹ˆë‹¤</div>`;
        } else {
          lessons.forEach(l => { html += renderLessonCard(l); });
        }

        $dayEvents.innerHTML = html;
        attachCardEvents($dayEvents);
      }

      function renderStats() {
        const ocaDone = data.lessons.filter(l => l.instrument === 'ocarina' && l.status === 'done').length;
        const ocaTotal = data.lessons.filter(l => l.instrument === 'ocarina').length;
        const ukuDone = data.lessons.filter(l => l.instrument === 'ukulele' && l.status === 'done').length;
        const ukuTotal = data.lessons.filter(l => l.instrument === 'ukulele').length;

        $stats.innerHTML = `
        <div class="stat-card stat-card--ocarina">
          <div class="stat-card__label">ğŸµ ì˜¤ì¹´ë¦¬ë‚˜ ì§„í–‰ë¥ </div>
          <div class="stat-card__value">${ocaDone} / ${ocaTotal}</div>
        </div>
        <div class="stat-card stat-card--ukulele">
          <div class="stat-card__label">ğŸ¸ ìš°ì¿¨ë ë ˆ ì§„í–‰ë¥ </div>
          <div class="stat-card__value">${ukuDone} / ${ukuTotal}</div>
        </div>
      `;
      }

      // â”€â”€â”€ Lesson Card HTML â”€â”€â”€
      function renderLessonCard(l) {
        const statusHtml = l.status === 'done'
          ? '<span class="lesson-card__status lesson-card__status--done">âœ… ì™„ë£Œ</span>'
          : '<span class="lesson-card__status lesson-card__status--upcoming">â³ ì˜ˆì •</span>';

        return `
        <div class="lesson-card lesson-card--${l.instrument}" data-id="${l.id}">
          <div class="lesson-card__header">
            <span class="lesson-card__week">${l.instrument === 'ocarina' ? 'ğŸµ' : 'ğŸ¸'} ${l.week}ì£¼ì°¨</span>
            <div class="lesson-card__actions">
              <button class="lesson-card__action" data-action="edit" data-id="${l.id}" title="ìˆ˜ì •">âœï¸</button>
              <button class="lesson-card__action lesson-card__action--delete" data-action="delete" data-id="${l.id}" title="ì‚­ì œ">ğŸ—‘ï¸</button>
            </div>
          </div>
          <div class="lesson-card__title">${l.title}</div>
          <div class="lesson-card__desc">${l.desc}</div>
          ${l.song ? `<span class="lesson-card__song">â™ª ${l.song}</span>` : ''}
          <div class="lesson-card__date">
            ${l.date ? `ğŸ“… ${koreanDate(l.date)}` : 'ğŸ“… ë‚ ì§œ ë¯¸ì •'}
            ${statusHtml}
          </div>
        </div>
      `;
      }

      function attachCardEvents(container) {
        container.querySelectorAll('[data-action="edit"]').forEach(btn => {
          btn.addEventListener('click', e => {
            e.stopPropagation();
            openEditModal(Number(btn.dataset.id));
          });
        });
        container.querySelectorAll('[data-action="delete"]').forEach(btn => {
          btn.addEventListener('click', e => {
            e.stopPropagation();
            confirmDelete(Number(btn.dataset.id));
          });
        });
        // Toggle done/upcoming on card click
        container.querySelectorAll('.lesson-card').forEach(card => {
          card.addEventListener('click', () => {
            const id = Number(card.dataset.id);
            const lesson = data.lessons.find(l => l.id === id);
            if (lesson) {
              lesson.status = lesson.status === 'done' ? 'upcoming' : 'done';
              saveData(data);
              showToast(lesson.status === 'done' ? 'âœ… ì™„ë£Œ ì²˜ë¦¬!' : 'â³ ì˜ˆì •ìœ¼ë¡œ ë³€ê²½', 'success');
              render();
            }
          });
        });
      }

      // â”€â”€â”€ List Rendering â”€â”€â”€
      function renderList(instrument, container) {
        const lessons = data.lessons
          .filter(l => l.instrument === instrument)
          .sort((a, b) => a.week - b.week);

        if (lessons.length === 0) {
          container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state__icon">${instrument === 'ocarina' ? 'ğŸµ' : 'ğŸ¸'}</div>
            <div class="empty-state__text">ë“±ë¡ëœ ìˆ˜ì—…ì´ ì—†ìŠµë‹ˆë‹¤.<br>ï¼‹ ë²„íŠ¼ìœ¼ë¡œ ì¶”ê°€í•´ ë³´ì„¸ìš”!</div>
          </div>
        `;
          return;
        }

        container.innerHTML = lessons.map(renderLessonCard).join('');
        attachCardEvents(container);
      }

      // â”€â”€â”€ Modal â”€â”€â”€
      function openAddModal() {
        editingId = null;
        $modalTitle.textContent = 'ìˆ˜ì—… ì¶”ê°€';
        $deleteRow.style.display = 'none';
        $fId.value = '';
        $fInstrument.value = currentTab === 'ukulele' ? 'ukulele' : 'ocarina';
        $fWeek.value = '';
        $fTitle.value = '';
        $fDesc.value = '';
        $fSong.value = '';
        $fDate.value = '';
        $fStatus.value = 'upcoming';
        $modalOvl.classList.add('active');
      }

      function openEditModal(id) {
        const lesson = data.lessons.find(l => l.id === id);
        if (!lesson) return;
        editingId = id;
        $modalTitle.textContent = 'ìˆ˜ì—… ìˆ˜ì •';
        $deleteRow.style.display = 'flex';
        $fId.value = id;
        $fInstrument.value = lesson.instrument;
        $fWeek.value = lesson.week;
        $fTitle.value = lesson.title;
        $fDesc.value = lesson.desc;
        $fSong.value = lesson.song || '';
        $fDate.value = lesson.date || '';
        $fStatus.value = lesson.status;
        $modalOvl.classList.add('active');
      }

      function closeModal() {
        $modalOvl.classList.remove('active');
        editingId = null;
      }

      // â”€â”€â”€ Form Submit â”€â”€â”€
      $form.addEventListener('submit', e => {
        e.preventDefault();
        const instrument = $fInstrument.value;
        const week = parseInt($fWeek.value) || 1;
        const title = $fTitle.value.trim();
        const desc = $fDesc.value.trim();
        const song = $fSong.value.trim();
        const date = $fDate.value;
        const status = $fStatus.value;

        if (!title) {
          showToast('ìˆ˜ì—… ì£¼ì œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”', 'error');
          return;
        }

        if (editingId) {
          const lesson = data.lessons.find(l => l.id === editingId);
          if (lesson) {
            Object.assign(lesson, { instrument, week, title, desc, song, date, status });
            showToast('âœï¸ ìˆ˜ì—…ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
          }
        } else {
          data.lessons.push({
            id: data.nextId++,
            instrument, week, title, desc, song, date, status,
          });
          showToast('âœ… ìˆ˜ì—…ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        }

        saveData(data);
        closeModal();
        render();
      });

      // â”€â”€â”€ Delete â”€â”€â”€
      let pendingDeleteId = null;

      function confirmDelete(id) {
        pendingDeleteId = id;
        document.getElementById('confirm-title').textContent = 'í™•ì¸';
        document.getElementById('confirm-msg').textContent = 'ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?';
        document.getElementById('confirm-yes').textContent = 'ì‚­ì œ';
        $confirmOvl.classList.add('active');
      }

      document.getElementById('confirm-yes').addEventListener('click', () => {
        if (pendingDeleteId === '__reset__') {
          localStorage.removeItem(STORAGE_KEY);
          data = initDefaultData();
          showToast('ğŸ”„ ì´ˆê¸°í™” ì™„ë£Œ!', 'success');
          render();
        } else if (pendingDeleteId != null) {
          data.lessons = data.lessons.filter(l => l.id !== pendingDeleteId);
          saveData(data);
          showToast('ğŸ—‘ï¸ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
          closeModal();
          render();
        }
        pendingDeleteId = null;
        $confirmOvl.classList.remove('active');
      });

      document.getElementById('confirm-no').addEventListener('click', () => {
        pendingDeleteId = null;
        $confirmOvl.classList.remove('active');
      });

      document.getElementById('btn-delete').addEventListener('click', () => {
        if (editingId) confirmDelete(editingId);
      });

      // â”€â”€â”€ Toast â”€â”€â”€
      let toastTimer;
      function showToast(msg, type = 'success') {
        $toast.textContent = msg;
        $toast.className = `toast toast--${type} visible`;
        clearTimeout(toastTimer);
        toastTimer = setTimeout(() => { $toast.classList.remove('visible'); }, 2200);
      }

      // â”€â”€â”€ Reset â”€â”€â”€
      document.getElementById('btn-reset').addEventListener('click', () => {
        pendingDeleteId = '__reset__';
        document.getElementById('confirm-title').textContent = 'ì´ˆê¸°í™”';
        document.getElementById('confirm-msg').textContent = 'ëª¨ë“  ë°ì´í„°ë¥¼ ê¸°ë³¸ ì»¤ë¦¬í˜ëŸ¼ìœ¼ë¡œ ì´ˆê¸°í™”í• ê¹Œìš”?';
        document.getElementById('confirm-yes').textContent = 'ì´ˆê¸°í™”';
        $confirmOvl.classList.add('active');
      });

      // â”€â”€â”€ Events â”€â”€â”€
      $fab.addEventListener('click', openAddModal);
      document.getElementById('btn-cancel').addEventListener('click', closeModal);
      $modalOvl.addEventListener('click', e => { if (e.target === $modalOvl) closeModal(); });

      // â”€â”€â”€ Master Render â”€â”€â”€
      function render() {
        renderStats();
        renderCalendar();
        renderDayEvents();
        renderList('ocarina', $ocarList);
        renderList('ukulele', $ukuList);
      }

      // Initial render
      render();

    })();
  </script>

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js')
        .then(reg => console.log('SW registered:', reg.scope))
        .catch(err => console.log('SW registration failed:', err));
    }
  </script>
</body>

</html>